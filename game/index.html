<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Spiel</title>
</head>
<body>

<h3>Spiel Einstellungen:</h3>

<form id="roundForm">
    <label>
        <input type="checkbox" name="cbAbsolutMode">
        Deterministischer Modus
    </label>

    <h3>Wähle deine Waffe:</h3>
    <input list="waffen" id="waffe_input">
    <input type="hidden" name="waffe_id" id="waffe_id">

    <datalist id="waffen">
        <option id="0" value="Faust">
        <option id="1" value="Dolch">
        <option id="2" value="Schwert">
        <option id="3" value="Laserschwert">
        <option id="4" value="Magie">
    </datalist>

    <h3>Wähle deine Verteidigungsrichtung:</h3>
    <input list="blockrichtung" id="block_input">
    <input type="hidden" name="block_id" id="block_id">

    <datalist id="blockrichtung">
        <option id="0" value="Oben">
        <option id="1" value="Unten">
        <option id="2" value="Mitte">
    </datalist>

    <h3>Wähle deine Angriffsrichtung:</h3>
    <input list="angriff" id="angriff_input">
    <input type="hidden" name="angriff_id" id="angriff_id">

    <datalist id="angriff">
        <option id="0" value="Oben">
        <option id="1" value="Unten">
        <option id="2" value="Mitte">
    </datalist>

    <br><br>
    <button type="submit">Runde starten</button>
</form>

<p id="output"></p>

<script>
function attachIdResolver(inputId, listId, hiddenId) {
    const input = document.getElementById(inputId);
    const list = document.getElementById(listId).options;
    const hidden = document.getElementById(hiddenId);

    input.addEventListener("input", function () {
        hidden.value = ""; // reset

        for (let opt of list) {
            if (opt.value === input.value) {
                hidden.value = opt.id;
                break;
            }
        }
    });
}

attachIdResolver("waffe_input", "waffen", "waffe_id");

attachIdResolver("block_input", "blockrichtung", "block_id");

attachIdResolver("angriff_input", "angriff", "angriff_id");


document.getElementById("roundForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const formData = new FormData(this);

    let response = await fetch("logic/Runden.php", {
        method: "POST",
        body: formData
    });

    let data = await response.json();
    document.getElementById("output").innerHTML = data.error || data.text;
});
</script>

</body>
</html>
